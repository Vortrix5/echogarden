services:
  api:
    build: ./api
    env_file: .env
    environment:
      - EG_WATCH_ROOTS=/host_watch
      - EG_POLL_INTERVAL=${EG_POLL_INTERVAL:-2}
      - EG_MAX_FILE_MB=${EG_MAX_FILE_MB:-20}
      - TIKA_URL=http://tika:9998
      - QDRANT_URL=http://qdrant:6333
      - EG_MODELS_DIR=/data/models
      - EG_WHISPER_MODE=${EG_WHISPER_MODE:-local}
      - EG_OPENCLIP_MODE=${EG_OPENCLIP_MODE:-local}
      - EG_CAPTURE_API_KEY=${EG_CAPTURE_API_KEY:-}
    volumes:
      - ./data:/data
      - ${EG_HOST_WATCH_PATH:-./host_watch}:/host_watch:ro
    ports:
      - "127.0.0.1:8000:8000"
    depends_on:
      - qdrant
      - tika

  tika:
    image: apache/tika:2.9.0.0-full
    expose:
      - "9998"
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:latest
    volumes:
      - ./data/qdrant:/qdrant/storage
    ports:
      - "127.0.0.1:6333:6333"
